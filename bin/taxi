#!/usr/bin/env bash

function error_handler() {
  >&2 echo "Exited with BAD EXIT CODE '${2}' in ${0} script at line: ${1}."
  exit "$2"
}
trap 'error_handler ${LINENO} $?' ERR
set -o errtrace -o errexit -o nounset -o pipefail

# find all markdown files in docs and iterate over them
# for each one, run aider to with that file and the Di√°taxis overview at diataxis.md
# ask aider to return one word for each file, one of: tutorial, how_to_guide, reference, explanation, or do_not_touch

for file in $(find docs -name '*.md'); do
  echo "Processing file: ${file}"
  # echo "Aider says: $(aider -f ${file} --read-only docs/diataxis.md --no-auto-commits --message "just return one word for each file, one of: tutorial, howtoguide, reference, explanation, or donottouch")"
  custom_aider --yes -f "${file}" --read diataxis.md --no-auto-commits --message "add a line with a list of keywords (like Keywords: tutorial, debugging_diagrams) to the end of ${file}, including these possible keywords: tutorial, how_to_guide, reference, explanation, building_diagrams, debugging_diagrams, dev_docs, devops. Be conservative with the keywords, only include the ones that are most relevant based on the content in the same file. for dev_docs, building_diagrams, and debugging_diagrams, the files MUST have dev/, Building_Diagrams/, or Debugging_Diagrams/ in their path, respectively. The main four categories are: tutorial, how_to_guide, reference, explanation, should be mutually exclusive, so do not include both tutorial and reference, for example."
done
